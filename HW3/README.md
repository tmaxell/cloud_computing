# Развертывание Backend-Frontend приложения в Kubernetes

## Архитектура приложения

Приложение состоит из двух основных сервисов:

-   **Backend**: Легковесный API на **Python/Flask**. Он разворачивается в трех экземплярах (репликах) для обеспечения отказоустойчивости. При запросе возвращает JSON с информацией о поде, который обработал этот запрос.
-   **Frontend**: Статическая веб-страница (HTML/CSS/JS), обслуживаемая **Nginx**. Nginx также настроен как обратный прокси (reverse proxy), который перенаправляет все запросы с `_/_api_` на сервис бэкенда.

Внешний трафик попадает на сервис фронтенда (`LoadBalancer`), который передает его на Nginx. Nginx отдает пользователю `index.html`, а JavaScript на странице выполняет AJAX-запрос к `/api`, который Nginx проксирует на сервис бэкенда. Сервис бэкенда, в свою очередь, распределяет эти запросы между тремя доступными подами Flask.

```
[Интернет] -> [LoadBalancer Service (Frontend)] -> [Frontend Pod (Nginx)]
                                                            |
                                                            +-> (отдает index.html)
                                                            |
                                                            +-> (проксирует /api) -> [ClusterIP Service (Backend)] -> [Один из Backend подов (Flask)]
```

## Предварительные требования

Для развертывания проекта на локальной машине вам понадобятся:

1.  **Git** для клонирования репозитория.
2.  **Docker Desktop**, запущенный и работающий.
3.  **Kubernetes**, активированный в настройках Docker Desktop:
    *   `Settings` -> `Kubernetes` -> `Enable Kubernetes`.

Утилита `kubectl` будет установлена и настроена автоматически вместе с Docker Desktop.

## Инструкция по развертыванию

### Клонирование репозитория

Склонируйте репозиторий на свой компьютер и перейдите в директорию проекта.

```sh
git clone <https://github.com/tmaxell/cloud_computing>
cd <cloud_computing>/HW3
```

### Развертывание в Kubernetes

Все необходимые Docker-образы уже собраны и доступны публично на Docker Hub. Манифесты Kubernetes настроены для их использования.

Для развертывания всех компонентов приложения выполните одну команду:

```sh
kubectl apply -f kubernetes/
```
Эта команда создаст все необходимые Deployments и Services в вашем локальном кластере Kubernetes. Процесс может занять 1-2 минуты, пока скачиваются образы.

## Проверка и тестирование

### Шаг 1: Проверка статуса подов

Убедитесь, что все поды успешно запустились и находятся в статусе `Running`.

```sh
kubectl get pods
```

Вы должны увидеть 1 под для фронтенда и 3 пода для бэкенда:
```
NAME                                   READY   STATUS    RESTARTS   AGE
backend-deployment-xxxxxxxxxx-abcde    1/1     Running   0          60s
backend-deployment-xxxxxxxxxx-fghij    1/1     Running   0          60s
backend-deployment-xxxxxxxxxx-klmno    1/1     Running   0          60s
frontend-deployment-yyyyyyyyyy-pqrst   1/1     Running   0          60s
```

### Шаг 2: Доступ к приложению

Сервис фронтенда настроен как `LoadBalancer`, который в Docker Desktop доступен через `localhost`.

1.  Откройте веб-браузер и перейдите по адресу:
    ```
    http://localhost
    ```
2.  Вы увидите веб-интерфейс приложения. Данные от бэкенда загружаются автоматически при открытии страницы.

### Шаг 3: Тестирование балансировки нагрузки

1.  Нажмите на кнопку **"Получить данные с Backend"** несколько раз.
2.  Обратите внимание на значение поля `"pod_hostname"` в отображаемом JSON. Оно будет периодически меняться, показывая, что ваши запросы обрабатываются разными экземплярами (подами) бэкенд-сервиса. Это демонстрирует работу балансировки нагрузки внутри кластера.